# 【CloudWatch】システムを監視

## システム監視とは

- システムが正常な状態を保てるよう稼働状況やリソースを監視すること
- サーバーが正常に稼働しているか監視
- サーバーのCPUやメモリが枯渇、問題ないかのリソースを監視
- 目的
    - すぐに障害発生を確認できるようにする
    - 復旧にすぐに取りかかれるようにする
 
 ### システム監視の設定と運用
 
 - 「正常な状態」「正常な結果」を監視項目で定義する
    - 例 CPU使用率60%以下が正常
 - 「正常な状態」でなくなったときの対応方法を監視項目ごとに定義する
    - 例 CPU使用率が60%を超えたらサーバーを1台増やす
 - 「正常な状態」であることを継続的に確認する
    - 例 1分に1回モニタリングする
 - 「正常な状態」でなくなった場合に通知が届くように設定し、すぐに「正常な状態」に復旧させる
 
 ## 監視の種類
 
 - 死活監視
    - 正常にシステムが動作しているかを確認。サーバーやシステムが落ちてないか
 - メトリクス監視
    - パフォーマンスを定量的に監視。サーバーのリソース状況など
    - 指標を決め、指標が閾値以上・以下になっているかを把握
    
 ## 監視する際のポイント
 
 - システムや利用状況は変わるので、足りない監視を都度足していく
 - 項目が多すぎると監視疲れ、面倒になる
 - 最初は基本的な要素のみ監視
    - CPU、メモリ、Disk、ネットワークの使用率

## CloudWatchとは

- AWSサービスの監視やモニタリングができる運用監視のマネージドサービス
- AWSサービスのメトリクスを監視
- メトリクスに対して閾値を登録し、その条件を満たしたら通知する
- 通知サービスでAmazon SNSを使用
    - Publisher、Subscriberの構図
    - CloudWatchやEC2がAmazon SNSに対してメッセージを送信(Publisher)
    - スマホやEmail、EC2で通知を受信(Subscriber)
    - それらを管理しているのがAmazon SNS
    - Amazon SNSはどこからどこへの通知かをトピックを作成して管理する
