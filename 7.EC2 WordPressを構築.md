# 【EC2】WordPressを構築

- WebサーバーにWordPressをインストール
- WordPressからデータベースを接続

## WordPress用のデータベースを作成

1. データベース作成
2. ユーザー作成
3. ユーザーに権限付与

### データベース作成

SSHにログイン
```terminal
$ ssh -i {秘密鍵}.pem ec2-user@{IPv4パブリックIP}
```

MySQLコマンドでRDSへ接続
```terminal
$ mysql -h {エンドポイント} -u {マスターユーザー名} -p
```
- `RDS/データベース`で作成したデータベースの`エンドポイント`をコピー

データベース作成
```terminal
MySQL [(none)]> CREATE DATABASE {データベース名} DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
```
- `CREATE DATABASE`はデータベースを作成するコマンド
- `DEFAULT CHARACTER SET`でデフォルトの文字コード指定
- `COLLATE`は比較に対するデフォルト照合順序

データベースが作成されたか確認
```terminal
MySQL [(none)]> SHOW DATABASES;
```

WordPress用のユーザー作成
```terminal
MySQL [(none)]> CREATE USER '{ユーザー名}'@'%' IDENTIFIED BY '{パスワード}';
```
- `'@'%'`で接続元はどこでもOK
- `IDENTIFIED BY`でパスワードを指定

作成したユーザーに権限付与
```terminal
MySQL [(none)]> GRANT ALL ON {データベース名}.* TO '{ユーザー名}'@'%';
```
- `GRANT`コマンドで権限付与
- `ALL`で全ての操作権限を付与
- `{データベース名}.*`でデータベースの全てのテーブルを操作できる

設定を反映させる
```terminal
MySQL [(none)]> FLUSH PRIVILEGES;
```

ユーザー作成が反映されたか確認
```terminal
MySQL [(none)]> SELECT user , host FROM mysql.user;
```

作成したユーザーでMySQLに接続できるか確認
```terminal
$ mysql -h {エンドポイント} -u {作成したユーザー名} -p
```
- ログアウトする

## WordPressのインストール

1. ライブラリのインストール
2. WordPressのダウンロード
3. WordPressの解凍
4. WordPressのプログラムをApacheあら見える場所に配置(/var/www/html)
5. WordPressファイルの所有者をApacheに変更
6. Apacheの再起動

### ライブラリのインストール

SSHにログイン
```terminal
$ ssh -i {秘密鍵}.pem ec2-user@{IPv4パブリックIP}
```

'amazon-linux-extras'からphp7.2をinstall
```terminal
$ sudo amazon-linux-extras install -y php7.2
```

php7.2に対応したライブラリのインストール
```terminal
$ sudo yum install -y php php-mbstring
```

### WordPressのダウンロード

homeディレクトリでダウンロード
```terminal
$ cd ~
$ wget https://ja.wordpress.org/latest-ja.tar.gz
```
- `wget`コマンドはURLを指定してファイルをダウンロードする

### WordPressの解凍

```terminal
$ tar xzvf latest-ja.tar.gz
```
- `tar`は複数のファイルを圧縮したり解凍するコマンド
- `xzvf`はgzファイルを解凍する

### WordPressのプログラムをApacheあら見える場所に配置(/var/www/html)

```terminal
$ cd wordpress/
$ sudo cp -r * /var/www/html/
```

- `/var/www/html`はApacheが参照しているディレクトリ
- ブラウザからアクセスがあるとそのディレクトリに配置されているファイルを読む
- `-r *`でカレントディレクトリの全てのディレクト/ファイルを対象

### WordPressファイルの所有者をApacheに変更

```terminal
$ sudo chown apache:apache /var/www/html/ -R
```
- `chown`コマンドでWordPressの所有者を変更
- `apache:apache`で所有者をApacheに変更
- `-R`は指定したファイル以下全てが対象

### Apacheの再起動

Apacheの起動状態を確認
```terminal
$ sudo systemctl status httpd.service
```
- `Active: active (running)`で起動中

Apacheの起動コマンド
```terminal
$ sudo systemctl start httpd.service
```

Apacheの再起動コマンド
```terminal
$ sudo systemctl restart httpd.service
```

## WordPressの設定

- データベース名、ユーザー名、パスワードはMySQLコマンドで作成したDATABASEを使用
- データベースのホスト名は`RDS/データベース/作成したデータベース名のエンドポイント`を指定
- テーブル接頭辞は`wp_`のまま
